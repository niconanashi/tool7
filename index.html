async function handleConversion(file) {
        downloadBtn.style.display = 'none';
        status.innerText = "変換中... (少し時間がかかります)";
        
        const name = file.name.split('.').slice(0, -1).join('.');
        const inputName = 'input_file';

        try {
            ffmpeg.FS('writeFile', inputName, await fetchFile(file));

            // AAC変換 (.m4aコンテナに入れることで時間を正確にする)
            status.innerText = "AAC (M4A) に変換中...";
            // -b:a 128k (ビットレート固定) と -movflags +faststart (ヘッダーを先頭に) を追加
            await ffmpeg.run('-i', inputName, '-c:a', 'aac', '-b:a', '128k', '-movflags', '+faststart', 'out.m4a');
            const aacData = ffmpeg.FS('readFile', 'out.m4a');

            // OGG 変換
            status.innerText = "OGGに変換中...";
            await ffmpeg.run('-i', inputName, '-c:a', 'libvorbis', '-q:a', '4', 'out.ogg');
            const oggData = ffmpeg.FS('readFile', 'out.ogg');

            // ZIP化
            status.innerText = "ZIPを作成中...";
            const zip = new JSZip();
            // 拡張子を .m4a と .ogg にして保存
            zip.file(`${name}.m4a`, aacData);
            zip.file(`${name}.ogg`, oggData);
            const blob = await zip.generateAsync({ type: "blob" });

            const url = URL.createObjectURL(blob);
            downloadBtn.onclick = () => {
                const a = document.createElement('a');
                a.href = url;
                a.download = `${name}_converted.zip`;
                a.click();
            };
            
            status.innerText = "完了！再生時間も修正されました。";
            downloadBtn.style.display = 'block';

        } catch (err) {
            console.error(err);
            status.innerText = "エラーが発生しました。";
        }
    }
